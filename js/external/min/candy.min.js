var Candy=function(e,t){return e.about={name:"Candy",version:"1.0.9"},e.init=function(n,r){e.View.init(t("#candy"),r.view),e.Core.init(n,r.core)},e}(Candy||{},jQuery);Candy.Core=function(e,t,n){var r=null,i=null,s=null,o={},u=!1,a={autojoin:!0,debug:!1},f=function(e,n){t.addNamespace(e,n)},l=function(){f("PRIVATE","jabber:iq:private"),f("BOOKMARKS","storage:bookmarks"),f("PRIVACY","jabber:iq:privacy"),f("DELAY","jabber:x:delay")},c=function(){e.addHandler(e.Event.Jabber.Version,t.NS.VERSION,"iq"),e.addHandler(e.Event.Jabber.Presence,null,"presence"),e.addHandler(e.Event.Jabber.Message,null,"message"),e.addHandler(e.Event.Jabber.Bookmarks,t.NS.PRIVATE,"iq"),e.addHandler(e.Event.Jabber.Room.Disco,t.NS.DISCO_INFO,"iq"),e.addHandler(e.Event.Jabber.PrivacyList,t.NS.PRIVACY,"iq","result"),e.addHandler(e.Event.Jabber.PrivacyListError,t.NS.PRIVACY,"iq","error")};return e.init=function(s,o){i=s,n.extend(!0,a,o),a.debug&&(e.log=function(e){try{typeof window.console!==undefined&&typeof window.console.log!==undefined&&console.log(e)}catch(t){}},e.log("[Init] Debugging enabled")),l(),r=new t.Connection(i),r.rawInput=e.rawInput.bind(e),r.rawOutput=e.rawOutput.bind(e),window.onbeforeunload=e.onWindowUnload,n.browser.mozilla&&n(document).keydown(function(e){e.which===27&&e.preventDefault()})},e.connect=function(n,i,o){r.reset(),c(),u=u?!0:n&&n.indexOf("@")<0,n&&i?(r.connect(_getEscapedJidFromJid(n)+"/"+Candy.about.name,i,Candy.Core.Event.Strophe.Connect),s=new e.ChatUser(n,t.getNodeFromJid(n))):n&&o?(r.connect(_getEscapedJidFromJid(n)+"/"+Candy.about.name,null,Candy.Core.Event.Strophe.Connect),s=new e.ChatUser(null,o)):n?Candy.Core.Event.Login(n):Candy.Core.Event.Login()},_getEscapedJidFromJid=function(e){var n=t.getNodeFromJid(e),r=t.getDomainFromJid(e);return n?t.escapeNode(n)+"@"+r:r},e.attach=function(n,i,o){s=new e.ChatUser(n,t.getNodeFromJid(n)),c(),r.attach(n,i,o,Candy.Core.Event.Strophe.Connect)},e.disconnect=function(){r.connected&&(n.each(e.getRooms(),function(){Candy.Core.Action.Jabber.Room.Leave(this.getJid())}),r.disconnect())},e.addHandler=function(e,t,n,i,s,o,u){return r.addHandler(e,t,n,i,s,o,u)},e.getUser=function(){return s},e.setUser=function(e){s=e},e.getConnection=function(){return r},e.getRooms=function(){return o},e.isAnonymousConnection=function(){return u},e.getOptions=function(){return a},e.getRoom=function(e){return o[e]?o[e]:null},e.onWindowUnload=function(){r.sync=!0,e.disconnect(),r.flush()},e.rawInput=function(e){this.log("RECV: "+e)},e.rawOutput=function(e){this.log("SENT: "+e)},e.log=function(){},e}(Candy.Core||{},Strophe,jQuery),Candy.View=function(e,t){var n={container:null,roomJid:null},r={language:"en",resources:"res/",messages:{limit:2e3,remove:500},crop:{message:{nickname:15,body:1e3},roster:{nickname:15}}},i=function(n){t.i18n.setDictionary(e.Translation[n])},s=function(){Candy.Core.Event.addObserver(Candy.Core.Event.KEYS.CHAT,e.Observer.Chat),Candy.Core.Event.addObserver(Candy.Core.Event.KEYS.PRESENCE,e.Observer.Presence),Candy.Core.Event.addObserver(Candy.Core.Event.KEYS.PRESENCE_ERROR,e.Observer.PresenceError),Candy.Core.Event.addObserver(Candy.Core.Event.KEYS.MESSAGE,e.Observer.Message),Candy.Core.Event.addObserver(Candy.Core.Event.KEYS.LOGIN,e.Observer.Login)},o=function(){t.browser.msie&&!t.browser.version.match("^9")?t(document).focusin(Candy.View.Pane.Window.onFocus).focusout(Candy.View.Pane.Window.onBlur):t(window).focus(Candy.View.Pane.Window.onFocus).blur(Candy.View.Pane.Window.onBlur),t(window).resize(Candy.View.Pane.Chat.fitTabs)},u=function(){t("#emoticons-icon").click(function(t){e.Pane.Chat.Context.showEmoticonsMenu(t.currentTarget),t.stopPropagation()}),t("#chat-autoscroll-control").click(Candy.View.Pane.Chat.Toolbar.onAutoscrollControlClick),t("#chat-sound-control").click(Candy.View.Pane.Chat.Toolbar.onSoundControlClick),Candy.Util.cookieExists("candy-nosound")&&t("#chat-sound-control").click(),t("#chat-statusmessage-control").click(Candy.View.Pane.Chat.Toolbar.onStatusMessageControlClick),Candy.Util.cookieExists("candy-nostatusmessages")&&t("#chat-statusmessage-control").click()},a=function(){t("body").delegate("li[data-tooltip]","mouseenter",Candy.View.Pane.Chat.Tooltip.show)};return e.init=function(e,f){t.extend(!0,r,f),i(r.language),Candy.Util.Parser.setEmoticonPath(this.getOptions().resources+"img/emoticons/"),n.container=e,n.container.html(Mustache.to_html(Candy.View.Template.Chat.pane,{tooltipEmoticons:t.i18n._("tooltipEmoticons"),tooltipSound:t.i18n._("tooltipSound"),tooltipAutoscroll:t.i18n._("tooltipAutoscroll"),tooltipStatusmessage:t.i18n._("tooltipStatusmessage"),tooltipAdministration:t.i18n._("tooltipAdministration"),tooltipUsercount:t.i18n._("tooltipUsercount"),resourcesPath:this.getOptions().resources},{tabs:Candy.View.Template.Chat.tabs,rooms:Candy.View.Template.Chat.rooms,modal:Candy.View.Template.Chat.modal,toolbar:Candy.View.Template.Chat.toolbar,soundcontrol:Candy.View.Template.Chat.soundcontrol})),o(),u(),s(),a()},e.getCurrent=function(){return n},e.getOptions=function(){return r},e}(Candy.View||{},jQuery),Candy.Util=function(e,t){return e.jidToId=function(e){return MD5.hexdigest(e)},e.escapeJid=function(e){var t=Strophe.escapeNode(Strophe.getNodeFromJid(e)),n=Strophe.getDomainFromJid(e),r=Strophe.getResourceFromJid(e);return e=t+"@"+n,r&&(e+="/"+Strophe.escapeNode(r)),e},e.unescapeJid=function(e){var t=Strophe.unescapeNode(Strophe.getNodeFromJid(e)),n=Strophe.getDomainFromJid(e),r=Strophe.getResourceFromJid(e);return e=t+"@"+n,r&&(e+="/"+Strophe.unescapeNode(r)),e},e.crop=function(e,t){return e.length>t&&(e=e.substr(0,t-3)+"..."),e},e.setCookie=function(e,t,n){var r=new Date;r.setDate((new Date).getDate()+n),document.cookie=e+"="+t+";expires="+r.toUTCString()+";path=/"},e.cookieExists=function(e){return document.cookie.indexOf(e)>-1},e.getCookie=function(e){if(document.cookie){var t=new RegExp(escape(e)+"=([^;]*)","gm"),n=t.exec(document.cookie);if(n)return n[1]}},e.deleteCookie=function(e){document.cookie=e+"=;expires=Thu, 01-Jan-70 00:00:01 GMT;path=/"},e.getPosLeftAccordingToWindowBounds=function(e,n){var r=t(document).width(),i=e.outerWidth(),s=i-e.outerWidth(!0),o="left";return n+i>=r&&(n-=i-s,o="right"),{px:n,backgroundPositionAlignment:o}},e.getPosTopAccordingToWindowBounds=function(e,n){var r=t(document).height(),i=e.outerHeight(),s=i-e.outerHeight(!0),o="top";return n+i>=r&&(n-=i-s,o="bottom"),{px:n,backgroundPositionAlignment:o}},e.localizedTime=function(n){if(n===undefined)return undefined;var r=e.iso8601toDate(n);return r.toDateString()===(new Date).toDateString()?r.format(t.i18n._("timeFormat")):r.format(t.i18n._("dateFormat"))},e.iso8601toDate=function(e){var t=Date.parse(e),n=0;if(isNaN(t)){var r=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?))?/.exec(e);if(r)return r[8]!=="Z"&&(n=+r[10]*60+ +r[11],r[9]==="+"&&(n=-n)),new Date(+r[1],+r[2]-1,+r[3],+r[4],+r[5]+n,+r[6],r[7]?+r[7].substr(0,3):0);t=Date.parse(e.replace(/^(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")+"Z")}return new Date(t)},e.isEmptyObject=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},e.forceRedraw=function(e){e.css({display:"none"}),setTimeout(function(){this.css({display:"block"})}.bind(e),1)},e.Parser={_emoticonPath:"",setEmoticonPath:function(e){this._emoticonPath=e},emoticons:[{plain:":)",regex:/((\s):-?\)|:-?\)(\s|$))/gm,image:"Smiling.png"},{plain:";)",regex:/((\s);-?\)|;-?\)(\s|$))/gm,image:"Winking.png"},{plain:":D",regex:/((\s):-?D|:-?D(\s|$))/gm,image:"Grinning.png"},{plain:";D",regex:/((\s);-?D|;-?D(\s|$))/gm,image:"Grinning_Winking.png"},{plain:":(",regex:/((\s):-?\(|:-?\((\s|$))/gm,image:"Unhappy.png"},{plain:"^^",regex:/((\s)\^\^|\^\^(\s|$))/gm,image:"Happy_3.png"},{plain:":P",regex:/((\s):-?P|:-?P(\s|$))/igm,image:"Tongue_Out.png"},{plain:";P",regex:/((\s);-?P|;-?P(\s|$))/igm,image:"Tongue_Out_Winking.png"},{plain:":S",regex:/((\s):-?S|:-?S(\s|$))/igm,image:"Confused.png"},{plain:":/",regex:/((\s):-?\/|:-?\/(\s|$))/gm,image:"Uncertain.png"},{plain:"8)",regex:/((\s)8-?\)|8-?\)(\s|$))/gm,image:"Sunglasses.png"},{plain:"$)",regex:/((\s)\$-?\)|\$-?\)(\s|$))/gm,image:"Greedy.png"},{plain:"oO",regex:/((\s)oO|oO(\s|$))/gm,image:"Huh.png"},{plain:":x",regex:/((\s):x|:x(\s|$))/gm,image:"Lips_Sealed.png"},{plain:":666:",regex:/((\s):666:|:666:(\s|$))/gm,image:"Devil.png"},{plain:"<3",regex:/((\s)&lt;3|&lt;3(\s|$))/gm,image:"Heart.png"}],emotify:function(e){var t;for(t=this.emoticons.length-1;t>=0;t--)e=e.replace(this.emoticons[t].regex,'$2<img class="emoticon" alt="$1" src="'+this._emoticonPath+this.emoticons[t].image+'" />$3');return e},linkify:function(e){return e=e.replace(/(^|[^\/])(www\.[^\.]+\.[\S]+(\b|$))/gi,"$1http://$2"),e.replace(/(\b(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/ig,'<a href="$1" target="_blank">$1</a>')},escape:function(e){return t("<div/>").text(e).html()},all:function(e){return e&&(e=this.escape(e),e=this.linkify(e),e=this.emotify(e)),e}},e}(Candy.Util||{},jQuery),Candy.Util.Observable=function(e){var t={};return e.addObserver=function(e,n){t[e]===undefined&&(t[e]=[]),t[e].push(n)},e.deleteObserver=function(e,n){delete t[e][n]},e.clearObservers=function(e){e!==undefined?t[e]=[]:t={}},e.notifyObservers=function(n,r){var i=t[n],s;for(s=i.length-1;s>=0;s--)i[s].update(e,r)},e}(Candy.Util.Observable||{}),Candy.Core.Action=function(e,t,n){return e.Jabber={Version:function(e){Candy.Core.getConnection().send($iq({type:"result",to:e.attr("from"),from:e.attr("to"),id:e.attr("id")}).c("query",{name:Candy.about.name,version:Candy.about.version,os:navigator.userAgent}))},Roster:function(){Candy.Core.getConnection().send($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.ROSTER}).tree())},Presence:function(e){Candy.Core.getConnection().send($pres(e).tree())},Services:function(){Candy.Core.getConnection().send($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.DISCO_ITEMS}).tree())},Autojoin:function(){Candy.Core.getOptions().autojoin===!0?Candy.Core.getConnection().send($iq({type:"get",xmlns:t.NS.CLIENT}).c("query",{xmlns:t.NS.PRIVATE}).c("storage",{xmlns:t.NS.BOOKMARKS}).tree()):n.isArray(Candy.Core.getOptions().autojoin)&&n.each(Candy.Core.getOptions().autojoin,function(){e.Jabber.Room.Join(this.valueOf())})},ResetIgnoreList:function(){Candy.Core.getConnection().send($iq({type:"set",from:Candy.Core.getUser().getJid(),id:"set1"}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).c("item",{action:"allow",order:"0"}).tree())},RemoveIgnoreList:function(){Candy.Core.getConnection().send($iq({type:"set",from:Candy.Core.getUser().getJid(),id:"remove1"}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).tree())},GetIgnoreList:function(){Candy.Core.getConnection().send($iq({type:"get",from:Candy.Core.getUser().getJid(),id:"get1"}).c("query",{xmlns:t.NS.PRIVACY}).c("list",{name:"ignore"}).tree())},SetIgnoreListActive:function(){Candy.Core.getConnection().send($iq({type:"set",from:Candy.Core.getUser().getJid(),id:"set2"}).c("query",{xmlns:t.NS.PRIVACY}).c("active",{name:"ignore"}).tree())},GetJidIfAnonymous:function(){Candy.Core.getUser().getJid()||(Candy.Core.log("[Jabber] Anonymous login"),Candy.Core.getUser().data.jid=Candy.Core.getConnection().jid)},Room:{Join:function(t,n,r){e.Jabber.Room.Disco(t),Candy.Core.getConnection().muc.join(t,Candy.Core.getUser().getNick(),null,null,n)},CreateInstantRoom:function(t){e.Jabber.Room.Disco(t);var n=$pres({from:Candy.Core.getUser().getNick(),to:t}).c("x",{xmlns:"http://jabber.org/protocol/muc"});Candy.Core.getConnection().send(n.tree()),Candy.Core.getConnection().muc.createInstantRoom(t)},SaveConfiguration:function(e,t){Candy.Core.getConnection().muc.saveConfiguration(e,t)},Configure:function(t){e.Jabber.Room.Disco(t),Candy.Core.getConnection().muc.getConfigure(t)},Leave:function(e){Candy.Core.getConnection().muc.leave(e,Candy.Core.getRoom(e).getUser().getNick(),function(){})},Disco:function(e){Candy.Core.getConnection().send($iq({type:"get",from:Candy.Core.getUser().getJid(),to:e,id:"disco3"}).c("query",{xmlns:t.NS.DISCO_INFO}).tree())},Message:function(e,t,r){return t=n.trim(t),t===""?!1:(Candy.Core.getConnection().muc.message(Candy.Util.escapeJid(e),undefined,t,r),!0)},IgnoreUnignore:function(e){Candy.Core.getUser().addToOrRemoveFromPrivacyList("ignore",e),Candy.Core.Action.Jabber.Room.UpdatePrivacyList()},UpdatePrivacyList:function(){var e=Candy.Core.getUser(),t=$iq({type:"set",from:e.getJid(),id:"edit1"}).c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"ignore"}),r=e.getPrivacyList("ignore");r.length>0?n.each(r,function(e,n){t.c("item",{type:"jid",value:Candy.Util.escapeJid(n),action:"deny",order:e}).c("message").up().up()}):t.c("item",{action:"allow",order:"0"}),Candy.Core.getConnection().send(t.tree())},Admin:{UserAction:function(e,n,r,i){var s,o={nick:t.escapeNode(t.getResourceFromJid(n))};switch(r){case"kick":s="kick1",o.role="none";break;case"ban":s="ban1",o.affiliation="outcast";break;default:return!1}return Candy.Core.getConnection().send($iq({type:"set",from:Candy.Core.getUser().getJid(),to:e,id:s}).c("query",{xmlns:t.NS.MUC_ADMIN}).c("item",o).c("reason").t(i).tree()),!0},SetSubject:function(e,t){Candy.Core.getConnection().muc.setTopic(e,t)}}}},e}(Candy.Core.Action||{},Strophe,jQuery),Candy.Core.ChatRoom=function(e){this.room={jid:e,name:null},this.user=null,this.roster=new Candy.Core.ChatRoster,this.setUser=function(e){this.user=e},this.getUser=function(){return this.user},this.getJid=function(){return this.room.jid},this.setName=function(e){this.room.name=e},this.getName=function(){return this.room.name},this.setRoster=function(e){this.roster=e},this.getRoster=function(){return this.roster}},Candy.Core.ChatRoster=function(){this.items={},this.add=function(e){this.items[e.getJid()]=e},this.remove=function(e){delete this.items[e]},this.get=function(e){return this.items[e]},this.getAll=function(){return this.items}},Candy.Core.ChatUser=function(e,t,n,r){this.ROLE_MODERATOR="moderator",this.AFFILIATION_OWNER="owner",this.data={jid:e,nick:Strophe.unescapeNode(t),affiliation:n,role:r,privacyLists:{},customData:{}},this.getJid=function(){if(this.data.jid)return Candy.Util.unescapeJid(this.data.jid);return},this.getEscapedJid=function(){return Candy.Util.escapeJid(this.data.jid)},this.getNick=function(){return Strophe.unescapeNode(this.data.nick)},this.getRole=function(){return this.data.role},this.getAffiliation=function(){return this.data.affiliation},this.isModerator=function(){return this.getRole()===this.ROLE_MODERATOR||this.getAffiliation()===this.AFFILIATION_OWNER},this.addToOrRemoveFromPrivacyList=function(e,t){this.data.privacyLists[e]||(this.data.privacyLists[e]=[]);var n=-1;return(n=this.data.privacyLists[e].indexOf(t))!==-1?this.data.privacyLists[e].splice(n,1):this.data.privacyLists[e].push(t),this.data.privacyLists[e]},this.getPrivacyList=function(e){return this.data.privacyLists[e]||(this.data.privacyLists[e]=[]),this.data.privacyLists[e]},this.isInPrivacyList=function(e,t){return this.data.privacyLists[e]?this.data.privacyLists[e].indexOf(t)!==-1:!1},this.setCustomData=function(e){this.data.customData=e},this.getCustomData=function(){return this.data.customData}},Candy.Core.Event=function(e,t,n,r){var i;for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);return e.KEYS={CHAT:1,PRESENCE:2,MESSAGE:3,LOGIN:4,PRESENCE_ERROR:5},e.Strophe={Connect:function(n){switch(n){case t.Status.CONNECTED:Candy.Core.log("[Connection] Connected"),Candy.Core.Action.Jabber.GetJidIfAnonymous();case t.Status.ATTACHED:Candy.Core.log("[Connection] Attached"),Candy.Core.Action.Jabber.Presence(),Candy.Core.Action.Jabber.Autojoin(),Candy.Core.Action.Jabber.GetIgnoreList();break;case t.Status.DISCONNECTED:Candy.Core.log("[Connection] Disconnected");break;case t.Status.AUTHFAIL:Candy.Core.log("[Connection] Authentication failed");break;case t.Status.CONNECTING:Candy.Core.log("[Connection] Connecting");break;case t.Status.DISCONNECTING:Candy.Core.log("[Connection] Disconnecting");break;case t.Status.AUTHENTICATING:Candy.Core.log("[Connection] Authenticating");break;case t.Status.ERROR:case t.Status.CONNFAIL:Candy.Core.log("[Connection] Failed ("+n+")");break;default:Candy.Core.log("[Connection] What?!")}e.notifyObservers(e.KEYS.CHAT,{type:"connection",status:n})}},e.Login=function(t){e.notifyObservers(e.KEYS.LOGIN,{presetJid:t})},e.Jabber={Version:function(e){return Candy.Core.log("[Jabber] Version"),Candy.Core.Action.Jabber.Version(n(e)),!0},Presence:function(r){return Candy.Core.log("[Jabber] Presence"),r=n(r),r.children('x[xmlns^="'+t.NS.MUC+'"]').length>0&&(r.attr("type")==="error"?e.Jabber.Room.PresenceError(r):e.Jabber.Room.Presence(r)),!0},Bookmarks:function(e){return Candy.Core.log("[Jabber] Bookmarks"),n("conference",e).each(function(){var e=n(this);e.attr("autojoin")&&Candy.Core.Action.Jabber.Room.Join(e.attr("jid"))}),!0},PrivacyList:function(e){Candy.Core.log("[Jabber] PrivacyList");var t=Candy.Core.getUser();return n('list[name="ignore"] item',e).each(function(){var e=n(this);e.attr("action")==="deny"&&t.addToOrRemoveFromPrivacyList("ignore",e.attr("value"))}),Candy.Core.Action.Jabber.SetIgnoreListActive(),!1},PrivacyListError:function(e){return Candy.Core.log("[Jabber] PrivacyListError"),n('error[code="404"][type="cancel"] item-not-found',e)&&(Candy.Core.Action.Jabber.ResetIgnoreList(),Candy.Core.Action.Jabber.SetIgnoreListActive()),!1},Message:function(r){Candy.Core.log("[Jabber] Message");var r=n(r),i=r.attr("from"),s=r.attr("type"),o=r.attr("to");return i===t.getDomainFromJid(i)||s!=="groupchat"&&s!=="chat"&&s!=="error"?!o&&i===t.getDomainFromJid(i)?e.notifyObservers(e.KEYS.CHAT,{type:s||"message",message:r.children("body").text()}):o&&i===t.getDomainFromJid(i)&&e.notifyObservers(e.KEYS.CHAT,{type:s||"message",subject:r.children("subject").text(),message:r.children("body").text()}):e.Jabber.Room.Message(r),!0},Room:{Leave:function(r){Candy.Core.log("[Jabber:Room] Leave");var r=n(r),i=r.attr("from"),s=t.getBareJidFromJid(i);if(!Candy.Core.getRoom(s))return!1;var o=Candy.Core.getRoom(s).getName(),u=r.find("item"),a="leave",f,l;delete Candy.Core.getRooms()[s],u.attr("role")==="none"&&(r.find("status").attr("code")==="307"?a="kick":r.find("status").attr("code")==="301"&&(a="ban"),f=u.find("reason").text(),l=u.find("actor").attr("jid"));var c=new Candy.Core.ChatUser(i,t.getResourceFromJid(i),u.attr("affiliation"),u.attr("role"));return e.notifyObservers(e.KEYS.PRESENCE,{roomJid:s,roomName:o,type:a,reason:f,actor:l,user:c}),!0},Disco:function(e){Candy.Core.log("[Jabber:Room] Disco");var e=n(e),r=t.getBareJidFromJid(e.attr("from"));Candy.Core.getRooms()[r]||(Candy.Core.getRooms()[r]=new Candy.Core.ChatRoom(r));var i=e.find("identity").attr("name"),s=Candy.Core.getRoom(r);return s.getName()===null&&s.setName(i),!0},Presence:function(n){Candy.Core.log("[Jabber:Room] Presence");var r=Candy.Util.unescapeJid(n.attr("from")),i=t.getBareJidFromJid(r),s=n.attr("type");if(t.getResourceFromJid(r)===Candy.Core.getUser().getNick()&&s==="unavailable")return e.Jabber.Room.Leave(n),!0;var o=Candy.Core.getRoom(i);o||(Candy.Core.getRooms()[i]=new Candy.Core.ChatRoom(i),o=Candy.Core.getRoom(i));var u=o.getRoster(),a,f,l=n.find("item");if(s!=="unavailable"){var c=t.getResourceFromJid(r);f=new Candy.Core.ChatUser(r,c,l.attr("affiliation"),l.attr("role")),o.getUser()===null&&Candy.Core.getUser().getNick()===c&&o.setUser(f),u.add(f),a="join"}else a="leave",l.attr("role")==="none"&&(n.find("status").attr("code")==="307"?a="kick":n.find("status").attr("code")==="301"&&(a="ban")),f=u.get(r),u.remove(r);return e.notifyObservers(e.KEYS.PRESENCE,{roomJid:i,roomName:o.getName(),user:f,action:a,currentUser:Candy.Core.getUser()}),!0},PresenceError:function(n){Candy.Core.log("[Jabber:Room] Presence Error");var r=Candy.Util.unescapeJid(n.attr("from")),i=t.getBareJidFromJid(r),s=Candy.Core.getRooms()[i],o=s.getName();delete s,e.notifyObservers(e.KEYS.PRESENCE_ERROR,{msg:n,type:n.children("error").children()[0].tagName.toLowerCase(),roomJid:i,roomName:o})},Message:function(n){Candy.Core.log("[Jabber:Room] Message");var r,i;if(n.children("subject").length>0)r=Candy.Util.unescapeJid(t.getBareJidFromJid(n.attr("from"))),i={name:t.getNodeFromJid(r),body:n.children("subject").text(),type:"subject"};else if(n.attr("type")==="error"){var s=n.children("error");s.attr("code")==="500"&&s.children("text").length>0&&(r=n.attr("from"),i={type:"info",body:s.children("text").text()})}else{if(!(n.children("body").length>0))return!0;if(n.attr("type")==="chat"){r=Candy.Util.unescapeJid(n.attr("from"));var o=t.getBareJidFromJid(r),u=!Candy.Core.getRoom(o),a=u?t.getNodeFromJid(r):t.getResourceFromJid(r);i={name:a,body:n.children("body").text(),type:n.attr("type"),isNoConferenceRoomJid:u}}else{r=Candy.Util.unescapeJid(t.getBareJidFromJid(n.attr("from")));var f=t.getResourceFromJid(n.attr("from"));f?(f=t.unescapeNode(f),i={name:f,body:n.children("body").text(),type:n.attr("type")}):i={name:"",body:n.children("body").text(),type:"info"}}}var l=n.children("delay")?n.children("delay"):n.children('x[xmlns="'+t.NS.DELAY+'"]'),c=l!==undefined?l.attr("stamp"):null;return e.notifyObservers(e.KEYS.MESSAGE,{roomJid:r,message:i,timestamp:c}),!0}}},e}(Candy.Core.Event||{},Strophe,jQuery,Candy.Util.Observable),Candy.View.Event=function(e,t){return e.Chat={onAdminMessage:function(e){return},onDisconnect:function(){return},onAuthfail:function(){return}},e.Room={onAdd:function(e){return},onShow:function(e){return},onHide:function(e){return},onSubjectChange:function(e){return},onClose:function(e){return},onPresenceChange:function(e){return}},e.Roster={onUpdate:function(e){return},onContextMenu:function(e){return{}},afterContextMenu:function(e){return}},e.Message={beforeShow:function(e){return e.message},onShow:function(e){return},beforeSend:function(e){return e}},e}(Candy.View.Event||{},jQuery),Candy.View.Observer=function(e,t){return e.Chat={update:function(e,n){if(n.type==="connection")switch(n.status){case Strophe.Status.CONNECTING:case Strophe.Status.AUTHENTICATING:Candy.View.Pane.Chat.Modal.show(t.i18n._("statusConnecting"),!1,!0);break;case Strophe.Status.ATTACHED:case Strophe.Status.CONNECTED:Candy.View.Pane.Chat.Modal.show(t.i18n._("statusConnected")),Candy.View.Pane.Chat.Modal.hide();break;case Strophe.Status.DISCONNECTING:Candy.View.Pane.Chat.Modal.show(t.i18n._("statusDisconnecting"),!1,!0);break;case Strophe.Status.DISCONNECTED:var r=Candy.Core.isAnonymousConnection()?Strophe.getDomainFromJid(Candy.Core.getUser().getJid()):null;Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("statusDisconnected"),r),Candy.View.Event.Chat.onDisconnect();break;case Strophe.Status.AUTHFAIL:Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("statusAuthfail")),Candy.View.Event.Chat.onAuthfail();break;default:Candy.View.Pane.Chat.Modal.show(t.i18n._("status",n.status))}else n.type==="message"?Candy.View.Pane.Chat.adminMessage(n.subject||"",n.message):(n.type==="chat"||n.type==="groupchat")&&Candy.View.Pane.Chat.onInfoMessage(Candy.View.getCurrent().roomJid,n.subject||"",n.message)}},e.Presence={update:function(n,r){if(r.type==="leave"){var i=Candy.View.Pane.Room.getUser(r.roomJid);Candy.View.Pane.Room.close(r.roomJid),e.Presence.notifyPrivateChats(i,r.type)}else if(r.type==="kick"||r.type==="ban"){var s=r.actor?Strophe.getNodeFromJid(r.actor):null,o,u=[r.roomName];s&&u.push(s);switch(r.type){case"kick":o=t.i18n._(s?"youHaveBeenKickedBy":"youHaveBeenKicked",u);break;case"ban":o=t.i18n._(s?"youHaveBeenBannedBy":"youHaveBeenBanned",u)}Candy.View.Pane.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.adminMessageReason,{reason:r.reason,_action:o,_reason:t.i18n._("reasonWas",[r.reason])})),setTimeout(function(){Candy.View.Pane.Chat.Modal.hide(function(){Candy.View.Pane.Room.close(r.roomJid),e.Presence.notifyPrivateChats(r.user,r.type)})},5e3),Candy.View.Event.Room.onPresenceChange({type:r.type,reason:r.reason,roomJid:r.roomJid,user:r.user})}else Candy.View.Pane.Chat.rooms[r.roomJid]||(Candy.View.Pane.Room.init(r.roomJid,r.roomName),Candy.View.Pane.Room.show(r.roomJid)),Candy.View.Pane.Roster.update(r.roomJid,r.user,r.action,r.currentUser),Candy.View.Pane.Chat.rooms[r.user.getJid()]&&(Candy.View.Pane.Roster.update(r.user.getJid(),r.user,r.action,r.currentUser),Candy.View.Pane.PrivateRoom.setStatus(r.user.getJid(),r.action))},notifyPrivateChats:function(e,t){Candy.Core.log("[View:Observer] notify Private Chats");var n;for(n in Candy.View.Pane.Chat.rooms)Candy.View.Pane.Chat.rooms.hasOwnProperty(n)&&Candy.View.Pane.Room.getUser(n)&&e.getJid()===Candy.View.Pane.Room.getUser(n).getJid()&&(Candy.View.Pane.Roster.update(n,e,t,e),Candy.View.Pane.PrivateRoom.setStatus(n,t))}},e.PresenceError={update:function(e,n){switch(n.type){case"not-authorized":var r;n.msg.children("x").children("password").length>0&&(r=t.i18n._("passwordEnteredInvalid",[n.roomName])),Candy.View.Pane.Chat.Modal.showEnterPasswordForm(n.roomJid,n.roomName,r);break;case"conflict":Candy.View.Pane.Chat.Modal.showNicknameConflictForm(n.roomJid);break;case"registration-required":Candy.View.Pane.Chat.Modal.showError("errorMembersOnly",[n.roomName]);break;case"service-unavailable":Candy.View.Pane.Chat.Modal.showError("errorMaxOccupantsReached",[n.roomName])}}},e.Message={update:function(e,t){t.message.type==="subject"?(Candy.View.Pane.Chat.rooms[t.roomJid]||(Candy.View.Pane.Room.init(t.roomJid,t.message.name),Candy.View.Pane.Room.show(t.roomJid)),Candy.View.Pane.Room.setSubject(t.roomJid,t.message.body)):t.message.type==="info"?Candy.View.Pane.Chat.infoMessage(t.roomJid,t.message.body):(t.message.type==="chat"&&!Candy.View.Pane.Chat.rooms[t.roomJid]&&Candy.View.Pane.PrivateRoom.open(t.roomJid,t.message.name,!1,t.message.isNoConferenceRoomJid),Candy.View.Pane.Message.show(t.roomJid,t.message.name,t.message.body,t.timestamp))}},e.Login={update:function(e,t){Candy.View.Pane.Chat.Modal.showLoginForm(null,t.presetJid)}},e}(Candy.View.Observer||{},jQuery),Candy.View.Pane=function(e,t){return e.Window={_hasFocus:!0,_plainTitle:document.title,_unreadMessagesCount:0,autoscroll:!0,hasFocus:function(){return e.Window._hasFocus},increaseUnreadMessages:function(){e.Window.renderUnreadMessages(++e.Window._unreadMessagesCount)},reduceUnreadMessages:function(t){e.Window._unreadMessagesCount-=t,e.Window._unreadMessagesCount<=0?e.Window.clearUnreadMessages():e.Window.renderUnreadMessages(e.Window._unreadMessagesCount)},clearUnreadMessages:function(){e.Window._unreadMessagesCount=0,document.title=e.Window._plainTitle},renderUnreadMessages:function(t){document.title=Candy.View.Template.Window.unreadmessages.replace("{{count}}",t).replace("{{title}}",e.Window._plainTitle)},onFocus:function(){e.Window._hasFocus=!0,Candy.View.getCurrent().roomJid&&(e.Room.setFocusToForm(Candy.View.getCurrent().roomJid),e.Chat.clearUnreadMessages(Candy.View.getCurrent().roomJid))},onBlur:function(){e.Window._hasFocus=!1}},e.Chat={rooms:[],addTab:function(n,r,i){var s=Candy.Util.jidToId(n),o=Mustache.to_html(Candy.View.Template.Chat.tab,{roomJid:n,roomId:s,name:r||Strophe.getNodeFromJid(n),privateUserChat:function(){return i==="chat"},roomType:i}),u=t(o).appendTo("#chat-tabs");u.click(e.Chat.tabClick),t("a.close",u).click(e.Chat.tabClose),e.Chat.fitTabs()},getTab:function(e){return t("#chat-tabs").children('li[data-roomjid="'+e+'"]')},removeTab:function(t){e.Chat.getTab(t).remove(),e.Chat.fitTabs()},setActiveTab:function(e){t("#chat-tabs").children().each(function(){var n=t(this);n.attr("data-roomjid")===e?n.addClass("active"):n.removeClass("active")})},increaseUnreadMessages:function(t){var n=this.getTab(t).find(".unread");n.show().text(n.text()!==""?parseInt(n.text(),10)+1:1),e.Chat.rooms[t].type==="chat"&&e.Window.increaseUnreadMessages()},clearUnreadMessages:function(t){var n=e.Chat.getTab(t).find(".unread");e.Window.reduceUnreadMessages(n.text()),n.hide().text("")},tabClick:function(n){var r=Candy.View.getCurrent().roomJid;e.Chat.rooms[r].scrollPosition=e.Room.getPane(r,".message-pane-wrapper").scrollTop(),e.Room.show(t(this).attr("data-roomjid")),n.preventDefault()},tabClose:function(n){var r=t(this).parent().attr("data-roomjid");return e.Chat.rooms[r].type==="chat"?e.Room.close(r):Candy.Core.Action.Jabber.Room.Leave(r),!1},allTabsClosed:function(){Candy.Core.disconnect(),e.Chat.Toolbar.hide();return},fitTabs:function(){var e=t("#chat-tabs").innerWidth(),n=0,r=t("#chat-tabs").children();r.each(function(){n+=t(this).css({width:"auto",overflow:"visible"}).outerWidth(!0)});if(n>e){var i=r.outerWidth(!0)-r.width(),s=Math.floor(e/r.length)-i;r.css({width:s,overflow:"hidden"})}},updateToolbar:function(n){t("#chat-toolbar").find(".context").click(function(t){e.Chat.Context.show(t.currentTarget,n),t.stopPropagation()}),Candy.View.Pane.Chat.Toolbar.updateUsercount(Candy.View.Pane.Chat.rooms[n].usercount)},adminMessage:function(n,r){if(Candy.View.getCurrent().roomJid){var i=Mustache.to_html(Candy.View.Template.Chat.adminMessage,{subject:n,message:r,sender:t.i18n._("administratorMessageSubject"),time:Candy.Util.localizedTime((new Date).toGMTString())});t("#chat-rooms").children().each(function(){e.Room.appendToMessagePane(t(this).attr("data-roomjid"),i)}),e.Room.scrollToBottom(Candy.View.getCurrent().roomJid),Candy.View.Event.Chat.onAdminMessage({subject:n,message:r})}},infoMessage:function(t,n,r){e.Chat.onInfoMessage(t,n,r)},onInfoMessage:function(n,r,i){if(Candy.View.getCurrent().roomJid){var s=Mustache.to_html(Candy.View.Template.Chat.infoMessage,{subject:r,message:t.i18n._(i),time:Candy.Util.localizedTime((new Date).toGMTString())});e.Room.appendToMessagePane(n,s),Candy.View.getCurrent().roomJid===n&&e.Room.scrollToBottom(Candy.View.getCurrent().roomJid)}},Toolbar:{show:function(){t("#chat-toolbar").show()},hide:function(){t("#chat-toolbar").hide()},playSound:function(){e.Chat.Toolbar.onPlaySound()},onPlaySound:function(){var e=document.getElementById("chat-sound-player");e.SetVariable("method:stop",""),e.SetVariable("method:play","")},onSoundControlClick:function(){var n=t("#chat-sound-control");n.hasClass("checked")?(e.Chat.Toolbar.playSound=function(){},Candy.Util.setCookie("candy-nosound","1",365)):(e.Chat.Toolbar.playSound=function(){e.Chat.Toolbar.onPlaySound()},Candy.Util.deleteCookie("candy-nosound")),n.toggleClass("checked")},onAutoscrollControlClick:function(){var n=t("#chat-autoscroll-control");n.hasClass("checked")?(e.Room.scrollToBottom=function(t){e.Room.onScrollToStoredPosition(t)},e.Window.autoscroll=!1):(e.Room.scrollToBottom=function(t){e.Room.onScrollToBottom(t)},e.Room.scrollToBottom(Candy.View.getCurrent().roomJid),e.Window.autoscroll=!0),n.toggleClass("checked")},onStatusMessageControlClick:function(){var n=t("#chat-statusmessage-control");n.hasClass("checked")?(e.Chat.infoMessage=function(){},Candy.Util.setCookie("candy-nostatusmessages","1",365)):(e.Chat.infoMessage=function(t,n,r){e.Chat.onInfoMessage(t,n,r)},Candy.Util.deleteCookie("candy-nostatusmessages")),n.toggleClass("checked")},updateUsercount:function(e){t("#chat-usercount").text(e)}},Modal:{show:function(n,r,i){r?e.Chat.Modal.showCloseControl():e.Chat.Modal.hideCloseControl(),i?e.Chat.Modal.showSpinner():e.Chat.Modal.hideSpinner(),t("#chat-modal").stop(!1,!0),t("#chat-modal-body").html(n),t("#chat-modal").fadeIn("fast"),t("#chat-modal-overlay").show()},hide:function(e){t("#chat-modal").fadeOut("fast",function(){t("#chat-modal-body").text(""),t("#chat-modal-overlay").hide()}),t(document).keydown(function(e){e.which===27&&e.preventDefault()}),e&&e()},showSpinner:function(){t("#chat-modal-spinner").show()},hideSpinner:function(){t("#chat-modal-spinner").hide()},showCloseControl:function(){t("#admin-message-cancel").show().click(function(t){e.Chat.Modal.hide(),t.preventDefault()}),t(document).keydown(function(t){t.which===27&&(e.Chat.Modal.hide(),t.preventDefault())})},hideCloseControl:function(){t("#admin-message-cancel").hide().click(function(){})},showLoginForm:function(n,r){e.Chat.Modal.show((n?n:"")+Mustache.to_html(Candy.View.Template.Login.form,{_labelUsername:t.i18n._("labelUsername"),_labelPassword:t.i18n._("labelPassword"),_loginSubmit:t.i18n._("loginSubmit"),displayPassword:!Candy.Core.isAnonymousConnection(),displayUsername:Candy.Core.isAnonymousConnection()||!r,presetJid:r?r:!1})),t("#login-form").children()[0].focus(),t("#login-form").submit(function(e){var n=t("#username").val(),i=t("#password").val();if(!Candy.Core.isAnonymousConnection()){var s=Candy.Core.getUser()&&n.indexOf("@")<0?n+"@"+Strophe.getDomainFromJid(Candy.Core.getUser().getJid()):n;s.indexOf("@")<0&&!Candy.Core.getUser()?Candy.View.Pane.Chat.Modal.showLoginForm(t.i18n._("loginInvalid")):Candy.Core.connect(s,i)}else Candy.Core.connect(r,null,n);return!1})},showEnterPasswordForm:function(n,r,i){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.enterPasswordForm,{roomName:r,_labelPassword:t.i18n._("labelPassword"),_label:i?i:t.i18n._("enterRoomPassword",[r]),_joinSubmit:t.i18n._("enterRoomPasswordSubmit")}),!0),t("#password").focus(),t("#enter-password-form").submit(function(){var r=t("#password").val();return e.Chat.Modal.hide(function(){Candy.Core.Action.Jabber.Room.Join(n,r)}),!1})},showNicknameConflictForm:function(n){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.nicknameConflictForm,{_labelNickname:t.i18n._("labelUsername"),_label:t.i18n._("nicknameConflict"),_loginSubmit:t.i18n._("loginSubmit")})),t("#nickname").focus(),t("#nickname-conflict-form").submit(function(){var r=t("#nickname").val();return e.Chat.Modal.hide(function(){Candy.Core.getUser().data.nick=r,Candy.Core.Action.Jabber.Room.Join(n)}),!1})},showError:function(n,r){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.PresenceError.displayError,{_error:t.i18n._(n,r)}),!0)}},Tooltip:{show:function(e,n){var r=t("#tooltip"),i=t(e.currentTarget);n||(n=i.attr("data-tooltip"));if(r.length===0){var s=Mustache.to_html(Candy.View.Template.Chat.tooltip);t("#chat-pane").append(s),r=t("#tooltip")}t("#context-menu").hide(),r.stop(!1,!0),r.children("div").html(n);var o=i.offset(),u=Candy.Util.getPosLeftAccordingToWindowBounds(r,o.left),a=Candy.Util.getPosTopAccordingToWindowBounds(r,o.top);r.css({left:u.px,top:a.px,backgroundPosition:u.backgroundPositionAlignment+" "+a.backgroundPositionAlignment}).fadeIn("fast"),i.mouseleave(function(e){e.stopPropagation(),t("#tooltip").stop(!1,!0).fadeOut("fast",function(){t(this).css({top:0,left:0})})})}},Context:{init:function(){if(t("#context-menu").length===0){var e=Mustache.to_html(Candy.View.Template.Chat.Context.menu);t("#chat-pane").append(e),t("#context-menu").mouseleave(function(){t(this).fadeOut("fast")})}},show:function(n,r,i){n=t(n);var s=e.Chat.rooms[r].id,o=t("#context-menu"),u=t("ul li",o);t("#tooltip").hide(),i||(i=Candy.Core.getUser()),u.remove();var a=this.getMenuLinks(r,i,n),f,l=function(e,n){return function(r){r.data.callback(r,e,n),t("#context-menu").hide()}};for(f in a)if(a.hasOwnProperty(f)){var c=a[f],h=Mustache.to_html(Candy.View.Template.Chat.Context.menulinks,{roomId:s,"class":c["class"],id:f,label:c.label});t("ul",o).append(h),t("#context-menu-"+f).bind("click",c,l(r,i))}if(f){var p=n.offset(),d=Candy.Util.getPosLeftAccordingToWindowBounds(o,p.left),v=Candy.Util.getPosTopAccordingToWindowBounds(o,p.top);return o.css({left:d.px,top:v.px,backgroundPosition:d.backgroundPositionAlignment+" "+v.backgroundPositionAlignment}),o.fadeIn("fast"),Candy.View.Event.Roster.afterContextMenu({roomJid:r,user:i,element:o}),!0}},getMenuLinks:function(n,r,i){var s=t.extend(this.initialMenuLinks(i),Candy.View.Event.Roster.onContextMenu({roomJid:n,user:r,elem:i})),o;for(o in s)s.hasOwnProperty(o)&&s[o].requiredPermission!==undefined&&!s[o].requiredPermission(r,e.Room.getUser(n),i)&&delete s[o];return s},initialMenuLinks:function(){return{"private":{requiredPermission:function(e,t){return t.getNick()!==e.getNick()&&Candy.Core.getRoom(Candy.View.getCurrent().roomJid)&&!Candy.Core.getUser().isInPrivacyList("ignore",e.getJid())},"class":"private",label:t.i18n._("privateActionLabel"),callback:function(e,n,r){t("#user-"+Candy.Util.jidToId(n)+"-"+Candy.Util.jidToId(r.getJid())).click()}},ignore:{requiredPermission:function(e,t){return t.getNick()!==e.getNick()&&!Candy.Core.getUser().isInPrivacyList("ignore",e.getJid())},"class":"ignore",label:t.i18n._("ignoreActionLabel"),callback:function(e,t,n){Candy.View.Pane.Room.ignoreUser(t,n.getJid())}},unignore:{requiredPermission:function(e,t){return t.getNick()!==e.getNick()&&Candy.Core.getUser().isInPrivacyList("ignore",e.getJid())},"class":"unignore",label:t.i18n._("unignoreActionLabel"),callback:function(e,t,n){Candy.View.Pane.Room.unignoreUser(t,n.getJid())}},kick:{requiredPermission:function(e,t){return t.getNick()!==e.getNick()&&t.isModerator()&&!e.isModerator()},"class":"kick",label:t.i18n._("kickActionLabel"),callback:function(n,r,i){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("reason"),_submit:t.i18n._("kickActionLabel")}),!0),t("#context-modal-field").focus(),t("#context-modal-form").submit(function(n){return Candy.Core.Action.Jabber.Room.Admin.UserAction(r,i.getJid(),"kick",t("#context-modal-field").val()),e.Chat.Modal.hide(),!1})}},ban:{requiredPermission:function(e,t){return t.getNick()!==e.getNick()&&t.isModerator()&&!e.isModerator()},"class":"ban",label:t.i18n._("banActionLabel"),callback:function(n,r,i){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("reason"),_submit:t.i18n._("banActionLabel")}),!0),t("#context-modal-field").focus(),t("#context-modal-form").submit(function(n){return Candy.Core.Action.Jabber.Room.Admin.UserAction(r,i.getJid(),"ban",t("#context-modal-field").val()),e.Chat.Modal.hide(),!1})}},subject:{requiredPermission:function(e,t){return t.getNick()===e.getNick()&&t.isModerator()},"class":"subject",label:t.i18n._("setSubjectActionLabel"),callback:function(n,r,i){e.Chat.Modal.show(Mustache.to_html(Candy.View.Template.Chat.Context.contextModalForm,{_label:t.i18n._("subject"),_submit:t.i18n._("setSubjectActionLabel")}),!0),t("#context-modal-field").focus(),t("#context-modal-form").submit(function(n){Candy.Core.Action.Jabber.Room.Admin.SetSubject(r,t("#context-modal-field").val()),e.Chat.Modal.hide(),n.preventDefault()})}}}},showEmoticonsMenu:function(e){e=t(e);var n=e.offset(),r=t("#context-menu"),i=t("ul",r),s="",o;t("#tooltip").hide();for(o=Candy.Util.Parser.emoticons.length-1;o>=0;o--)s='<img src="'+Candy.Util.Parser._emoticonPath+Candy.Util.Parser.emoticons[o].image+'" alt="'+Candy.Util.Parser.emoticons[o].plain+'" />'+s;i.html('<li class="emoticons">'+s+"</li>"),i.find("img").click(function(){var e=Candy.View.Pane.Room.getPane(Candy.View.getCurrent().roomJid,".message-form").children(".field"),n=e.val(),r=t(this).attr("alt")+" ";e.val(n?n+" "+r:r).focus()});var u=Candy.Util.getPosLeftAccordingToWindowBounds(r,n.left),a=Candy.Util.getPosTopAccordingToWindowBounds(r,n.top);return r.css({left:u.px,top:a.px,backgroundPosition:u.backgroundPositionAlignment+" "+a.backgroundPositionAlignment}),r.fadeIn("fast"),!0}}},e.Room={init:function(n,r,i){i=i||"groupchat",Candy.Util.isEmptyObject(e.Chat.rooms)&&e.Chat.Toolbar.show();var s=Candy.Util.jidToId(n);return e.Chat.rooms[n]={id:s,usercount:0,name:r,type:i,messageCount:0,scrollPosition:-1},t("#chat-rooms").append(Mustache.to_html(Candy.View.Template.Room.pane,{roomId:s,roomJid:n,roomType:i,form:{_messageSubmit:t.i18n._("messageSubmit")},roster:{_userOnline:t.i18n._("userOnline")}},{roster:Candy.View.Template.Roster.pane,messages:Candy.View.Template.Message.pane,form:Candy.View.Template.Room.form})),e.Chat.addTab(n,r,i),e.Room.getPane(n,".message-form").submit(e.Message.submit),Candy.View.Event.Room.onAdd({roomJid:n,type:i,element:e.Room.getPane(n)}),s},show:function(n){var r=e.Chat.rooms[n].id;t(".room-pane").each(function(){var i=t(this);i.attr("id")==="chat-room-"+r?(i.show(),Candy.View.getCurrent().roomJid=n,e.Chat.updateToolbar(n),e.Chat.setActiveTab(n),e.Chat.clearUnreadMessages(n),e.Room.setFocusToForm(n),e.Room.scrollToBottom(n),Candy.View.Event.Room.onShow({roomJid:n,element:i})):(i.hide(),Candy.View.Event.Room.onHide({roomJid:n,element:i}))})},setSubject:function(n,r){var i=Mustache.to_html(Candy.View.Template.Room.subject,{subject:r,roomName:e.Chat.rooms[n].name,_roomSubject:t.i18n._("roomSubject"),time:Candy.Util.localizedTime((new Date).toGMTString())});e.Room.appendToMessagePane(n,i),e.Room.scrollToBottom(n),Candy.View.Event.Room.onSubjectChange({roomJid:n,element:e.Room.getPane(n),subject:r})},close:function(n){e.Chat.removeTab(n),e.Window.clearUnreadMessages(),e.Room.getPane(n).remove();var r=t("#chat-rooms").children();Candy.View.getCurrent().roomJid===n&&(Candy.View.getCurrent().roomJid=null,r.length===0?e.Chat.allTabsClosed():e.Room.show(r.last().attr("data-roomjid"))),delete e.Chat.rooms[n],Candy.View.Event.Room.onClose({roomJid:n})},appendToMessagePane:function(t,n){e.Room.getPane(t,".message-pane").append(n),e.Chat.rooms[t].messageCount++,e.Room.sliceMessagePane(t)},sliceMessagePane:function(t){if(e.Window.autoscroll){var n=Candy.View.getOptions().messages;e.Chat.rooms[t].messageCount>n.limit&&(e.Room.getPane(t,".message-pane").children().slice(0,n.remove*2).remove(),e.Chat.rooms[t].messageCount-=n.remove)}},scrollToBottom:function(t){e.Room.onScrollToBottom(t)},onScrollToBottom:function(t){var n=e.Room.getPane(t,".message-pane-wrapper");n.scrollTop(n.prop("scrollHeight"))},onScrollToStoredPosition:function(t){if(e.Chat.rooms[t].scrollPosition>-1){var n=e.Room.getPane(t,".message-pane-wrapper");n.scrollTop(e.Chat.rooms[t].scrollPosition),e.Chat.rooms[t].scrollPosition=-1}},setFocusToForm:function(t){var n=e.Room.getPane(t,".message-form");if(n)try{n.children(".field")[0].focus()}catch(r){}},setUser:function(n,r){e.Chat.rooms[n].user=r;var i=e.Room.getPane(n),s=t("#chat-pane");i.attr("data-userjid",r.getJid()),r.isModerator()?(r.getRole()===r.ROLE_MODERATOR&&s.addClass("role-moderator"),r.getAffiliation()===r.AFFILIATION_OWNER&&s.addClass("affiliation-owner")):s.removeClass("role-moderator affiliation-owner"),e.Chat.Context.init()},getUser:function(t){return e.Chat.rooms[t].user},ignoreUser:function(e,t){Candy.Core.Action.Jabber.Room.IgnoreUnignore(t),Candy.View.Pane.Room.addIgnoreIcon(e,t)},unignoreUser:function(e,t){Candy.Core.Action.Jabber.Room.IgnoreUnignore(t),Candy.View.Pane.Room.removeIgnoreIcon(e,t)},addIgnoreIcon:function(e,n){Candy.View.Pane.Chat.rooms[n]&&t("#user-"+Candy.View.Pane.Chat.rooms[n].id+"-"+Candy.Util.jidToId(n)).addClass("status-ignored"),Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(e)]&&t("#user-"+Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(e)].id+"-"+Candy.Util.jidToId(n)).addClass("status-ignored")},removeIgnoreIcon:function(e,n){Candy.View.Pane.Chat.rooms[n]&&t("#user-"+Candy.View.Pane.Chat.rooms[n].id+"-"+Candy.Util.jidToId(n)).removeClass("status-ignored"),Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(e)]&&t("#user-"+Candy.View.Pane.Chat.rooms[Strophe.getBareJidFromJid(e)].id+"-"+Candy.Util.jidToId(n)).removeClass("status-ignored")},getPane:function(n,r){if(e.Chat.rooms[n])return r?e.Chat.rooms[n]["pane-"+r]?e.Chat.rooms[n]["pane-"+r]:(e.Chat.rooms[n]["pane-"+r]=t("#chat-room-"+e.Chat.rooms[n].id).find(r),e.Chat.rooms[n]["pane-"+r]):t("#chat-room-"+e.Chat.rooms[n].id)}},e.PrivateRoom={open:function(n,r,i,s){var o=s?Candy.Core.getUser():e.Room.getUser(Strophe.getBareJidFromJid(n));if(Candy.Core.getUser().isInPrivacyList("ignore",n))return!1;e.Chat.rooms[n]||e.Room.init(n,r,"chat"),i&&e.Room.show(n),e.Roster.update(n,new Candy.Core.ChatUser(n,r),"join",o),e.Roster.update(n,o,"join",o),e.PrivateRoom.setStatus(n,"join"),s&&e.Chat.infoMessage(n,t.i18n._("presenceUnknownWarningSubject"),t.i18n._("presenceUnknownWarning")),Candy.View.Event.Room.onAdd({roomJid:n,type:"chat",element:e.Room.getPane(n)})},setStatus:function(t,n){var r=e.Room.getPane(t,".message-form");n==="join"?(e.Chat.getTab(t).addClass("online").removeClass("offline"),r.children(".field").removeAttr("disabled"),r.children(".submit").removeAttr("disabled"),e.Chat.getTab(t)):(e.Chat.getTab(t).addClass("offline").removeClass("online"),r.children(".field").attr("disabled",!0),r.children(".submit").attr("disabled",!0))}},e.Roster={update:function(n,r,i,s){var o=e.Chat.rooms[n].id,u=Candy.Util.jidToId(r.getJid()),a=-1;if(i==="join"){a=1;var f=Mustache.to_html(Candy.View.Template.Roster.user,{roomId:o,userId:u,userJid:r.getJid(),nick:r.getNick(),displayNick:Candy.Util.crop(r.getNick(),Candy.View.getOptions().crop.roster.nickname),role:r.getRole(),affiliation:r.getAffiliation(),me:s!==undefined&&r.getNick()===s.getNick(),tooltipRole:t.i18n._("tooltipRole"),tooltipIgnored:t.i18n._("tooltipIgnored")}),l=t("#user-"+o+"-"+u);if(l.length<1){var c=!1,h=e.Room.getPane(n,".roster-pane");if(h.children().length>0){var p=r.getNick().toUpperCase();h.children().each(function(){var e=t(this);return e.attr("data-nick").toUpperCase()>p?(e.before(f),c=!0,!1):!0})}c||h.append(f),e.Roster.joinAnimation("user-"+o+"-"+u),s!==undefined&&r.getNick()!==s.getNick()&&e.Room.getUser(n)&&(e.Chat.rooms[n].type==="chat"?e.Chat.onInfoMessage(n,t.i18n._("userJoinedRoom",[r.getNick()])):e.Chat.infoMessage(n,t.i18n._("userJoinedRoom",[r.getNick()])))}else a=0,l.replaceWith(f),t("#user-"+o+"-"+u).css({opacity:1}).show();s!==undefined&&s.getNick()===r.getNick()?e.Room.setUser(n,r):t("#user-"+o+"-"+u).click(e.Roster.userClick),t("#user-"+o+"-"+u+" .context").click(function(t){e.Chat.Context.show(t.currentTarget,n,r),t.stopPropagation()}),s!==undefined&&s.isInPrivacyList("ignore",r.getJid())&&Candy.View.Pane.Room.addIgnoreIcon(n,r.getJid())}else i==="leave"?(e.Roster.leaveAnimation("user-"+o+"-"+u),e.Chat.rooms[n].type==="chat"?e.Chat.onInfoMessage(n,t.i18n._("userLeftRoom",[r.getNick()])):e.Chat.infoMessage(n,t.i18n._("userLeftRoom",[r.getNick()]))):i==="kick"?(e.Roster.leaveAnimation("user-"+o+"-"+u),e.Chat.onInfoMessage(n,t.i18n._("userHasBeenKickedFromRoom",[r.getNick()]))):i==="ban"&&(e.Roster.leaveAnimation("user-"+o+"-"+u),e.Chat.onInfoMessage(n,t.i18n._("userHasBeenBannedFromRoom",[r.getNick()])));Candy.View.Pane.Chat.rooms[n].usercount+=a,n===Candy.View.getCurrent().roomJid&&Candy.View.Pane.Chat.Toolbar.updateUsercount(Candy.View.Pane.Chat.rooms[n].usercount),Candy.View.Event.Roster.onUpdate({roomJid:n,user:r,action:i,element:t("#user-"+o+"-"+u)})},userClick:function(){var n=t(this);e.PrivateRoom.open(n.attr("data-jid"),n.attr("data-nick"),!0)},joinAnimation:function(e){t("#"+e).stop(!0).slideDown("normal",function(){t(this).animate({opacity:1})})},leaveAnimation:function(e){t("#"+e).stop(!0).attr("id","#"+e+"-leaving").animate({opacity:0},{complete:function(){t(this).slideUp("normal",function(){t(this).remove()})}})}},e.Message={submit:function(n){var r=Candy.View.Pane.Chat.rooms[Candy.View.getCurrent().roomJid].type,i=t(this).children(".field").val().substring(0,Candy.View.getOptions().crop.message.body);i=Candy.View.Event.Message.beforeSend(i),Candy.Core.Action.Jabber.Room.Message(Candy.View.getCurrent().roomJid,i,r),r==="chat"&&i&&e.Message.show(Candy.View.getCurrent().roomJid,e.Room.getUser(Candy.View.getCurrent().roomJid).getNick(),i),t(this).children(".field").val("").focus(),n.preventDefault()},show:function(t,n,r,i){r=Candy.Util.Parser.all(r.substring(0,Candy.View.getOptions().crop.message.body)),r=Candy.View.Event.Message.beforeShow({roomJid:t,nick:n,message:r});if(!r)return;var s=Mustache.to_html(Candy.View.Template.Message.item,{name:n,displayName:Candy.Util.crop(n,Candy.View.getOptions().crop.message.nickname),message:r,time:Candy.Util.localizedTime(i||(new Date).toGMTString())});e.Room.appendToMessagePane(t,s);var o=e.Room.getPane(t,".message-pane").children().last();o.find("a.name").click(function(r){r.preventDefault(),n!==e.Room.getUser(Candy.View.getCurrent().roomJid).getNick()&&Candy.Core.getRoom(t).getRoster().get(t+"/"+n)&&Candy.View.Pane.PrivateRoom.open(t+"/"+n,n,!0)});if(Candy.View.getCurrent().roomJid!==t||!e.Window.hasFocus())e.Chat.increaseUnreadMessages(t),Candy.View.Pane.Chat.rooms[t].type==="chat"&&!e.Window.hasFocus()&&e.Chat.Toolbar.playSound();Candy.View.getCurrent().roomJid===t&&e.Room.scrollToBottom(t),Candy.View.Event.Message.onShow({roomJid:t,element:o,nick:n,message:r})}},e}(Candy.View.Pane||{},jQuery),Candy.View.Template=function(e){return e.Window={unreadmessages:"({{count}}) {{title}}"},e.Chat={pane:'<div id="chat-pane">{{> tabs}}{{> toolbar}}{{> rooms}}</div>{{> modal}}',rooms:'<div id="chat-rooms" class="rooms"></div>',tabs:'<ul id="chat-tabs"></ul>',tab:'<li class="roomtype-{{roomType}}" data-roomjid="{{roomJid}}" data-roomtype="{{roomType}}"><a href="#" class="label">{{#privateUserChat}}@{{/privateUserChat}}{{name}}</a><a href="#" class="transition"></a><a href="#" class="close">\u00d7</a><small class="unread"></small></li>',modal:'<div id="chat-modal"><a id="admin-message-cancel" class="close" href="#">\u00d7</a><span id="chat-modal-body"></span><img src="{{resourcesPath}}img/modal-spinner.gif" id="chat-modal-spinner" /></div><div id="chat-modal-overlay"></div>',adminMessage:'<dt>{{time}}</dt><dd class="adminmessage"><span class="label">{{sender}}</span>{{subject}} {{message}}</dd>',infoMessage:'<dt>{{time}}</dt><dd class="infomessage">{{subject}} {{message}}</dd>',toolbar:'<ul id="chat-toolbar"><li id="emoticons-icon" data-tooltip="{{tooltipEmoticons}}"></li><li id="chat-sound-control" class="checked" data-tooltip="{{tooltipSound}}">{{> soundcontrol}}</li><li id="chat-autoscroll-control" class="checked" data-tooltip="{{tooltipAutoscroll}}"></li><li class="checked" id="chat-statusmessage-control" data-tooltip="{{tooltipStatusmessage}}"></li><li class="context" data-tooltip="{{tooltipAdministration}}"></li><li class="usercount" data-tooltip="{{tooltipUsercount}}"><span id="chat-usercount"></span></li></ul>',soundcontrol:'<script type="text/javascript">var audioplayerListener = new Object(); audioplayerListener.onInit = function() { };</script><object id="chat-sound-player" type="application/x-shockwave-flash" data="{{resourcesPath}}audioplayer.swf" width="0" height="0"><param name="movie" value="{{resourcesPath}}audioplayer.swf" /><param name="AllowScriptAccess" value="always" /><param name="FlashVars" value="listener=audioplayerListener&amp;mp3={{resourcesPath}}notify.mp3" /></object>',Context:{menu:'<div id="context-menu"><ul></ul></div>',menulinks:'<li class="{{class}}" id="context-menu-{{id}}">{{label}}</li>',contextModalForm:'<form action="#" id="context-modal-form"><label for="context-modal-label">{{_label}}</label><input type="text" name="contextModalField" id="context-modal-field" /><input type="submit" class="button" name="send" value="{{_submit}}" /></form>',adminMessageReason:'<a id="admin-message-cancel" class="close" href="#">\u00d7</a><p>{{_action}}</p>{{#reason}}<p>{{_reason}}</p>{{/reason}}'},tooltip:'<div id="tooltip"><div></div></div>'},e.Room={pane:'<div class="room-pane roomtype-{{roomType}}" id="chat-room-{{roomId}}" data-roomjid="{{roomJid}}" data-roomtype="{{roomType}}">{{> roster}}{{> messages}}{{> form}}</div>',subject:'<dt>{{time}}</dt><dd class="subject"><span class="label">{{roomName}}</span>{{_roomSubject}} {{subject}}</dd>',form:'<div class="message-form-wrapper"></div><form method="post" class="message-form"><input name="message" class="field" type="text" autocomplete="off" maxlength="1000" /><input type="submit" class="submit" name="submit" value="{{_messageSubmit}}" /></form>'},e.Roster={pane:'<div class="roster-pane"></div>',user:'<div class="user role-{{role}} affiliation-{{affiliation}}{{#me}} me{{/me}}" id="user-{{roomId}}-{{userId}}" data-jid="{{userJid}}" data-nick="{{nick}}" data-role="{{role}}" data-affiliation="{{affiliation}}"><div class="label">{{displayNick}}</div><ul><li class="context" id="context-{{roomId}}-{{userId}}"></li><li class="role role-{{role}} affiliation-{{affiliation}}" data-tooltip="{{tooltipRole}}"></li><li class="ignore" data-tooltip="{{tooltipIgnored}}"></li></ul></div>'},e.Message={pane:'<div class="message-pane-wrapper"><dl class="message-pane"></dl></div>',item:'<dt>{{time}}</dt><dd><span class="label"><a href="#" class="name">{{displayName}}</a></span>{{{message}}}</dd>'},e.Login={form:'<form method="post" id="login-form" class="login-form">{{#displayUsername}}<label for="username">{{_labelUsername}}</label><input type="text" id="username" name="username"/>{{/displayUsername}}{{#presetJid}}<input type="hidden" id="username" name="username" value="{{presetJid}}"/>{{/presetJid}}{{#displayPassword}}<label for="password">{{_labelPassword}}</label><input type="password" id="password" name="password" />{{/displayPassword}}<input type="submit" class="button" value="{{_loginSubmit}}" /></form>'},e.PresenceError={enterPasswordForm:'<strong>{{_label}}</strong><form method="post" id="enter-password-form" class="enter-password-form"><label for="password">{{_labelPassword}}</label><input type="password" id="password" name="password" /><input type="submit" class="button" value="{{_joinSubmit}}" /></form>',nicknameConflictForm:'<strong>{{_label}}</strong><form method="post" id="nickname-conflict-form" class="nickname-conflict-form"><label for="nickname">{{_labelNickname}}</label><input type="text" id="nickname" name="nickname" /><input type="submit" class="button" value="{{_loginSubmit}}" /></form>',displayError:"<strong>{{_error}}</strong>"},e}(Candy.View.Template||{}),Candy.View.Translation={en:{status:"Status: %s",statusConnecting:"Connecting...",statusConnected:"Connected",statusDisconnecting:"Disconnecting...",statusDisconnected:"Disconnected",statusAuthfail:"Authentication failed",roomSubject:"Subject:",messageSubmit:"Send",labelUsername:"Username:",labelPassword:"Password:",loginSubmit:"Login",loginInvalid:"Invalid JID",reason:"Reason:",subject:"Subject:",reasonWas:"Reason was: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"You have been kicked from %2$s by %1$s",youHaveBeenKicked:"You have been kicked from %s",banActionLabel:"Ban",youHaveBeenBannedBy:"You have been banned from %1$s by %2$s",youHaveBeenBanned:"You have been banned from %s",privateActionLabel:"Private chat",ignoreActionLabel:"Ignore",unignoreActionLabel:"Unignore",setSubjectActionLabel:"Change Subject",administratorMessageSubject:"Administrator",userJoinedRoom:"%s joined the room.",userLeftRoom:"%s left the room.",userHasBeenKickedFromRoom:"%s has been kicked from the room.",userHasBeenBannedFromRoom:"%s has been banned from the room.",presenceUnknownWarningSubject:"Notice:",presenceUnknownWarning:"This user might be offline. We can't track his presence.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"You ignore this user",tooltipEmoticons:"Emoticons",tooltipSound:"Play sound for new private messages",tooltipAutoscroll:"Autoscroll",tooltipStatusmessage:"Display status messages",tooltipAdministration:"Room Administration",tooltipUsercount:"Room Occupants",enterRoomPassword:'Room "%s" is password protected.',enterRoomPasswordSubmit:"Join room",passwordEnteredInvalid:'Invalid password for room "%s".',nicknameConflict:"Username already in use. Please choose another one.",errorMembersOnly:'You can\'t join room "%s": Insufficient rights.',errorMaxOccupantsReached:'You can\'t join room "%s": Too many occupants.',antiSpamMessage:"Please do not spam. You have been blocked for a short-time."},de:{status:"Status: %s",statusConnecting:"Verbinden...",statusConnected:"Verbunden",statusDisconnecting:"Verbindung trennen...",statusDisconnected:"Verbindung getrennt",statusAuthfail:"Authentifizierung fehlgeschlagen",roomSubject:"Thema:",messageSubmit:"Senden",labelUsername:"Benutzername:",labelPassword:"Passwort:",loginSubmit:"Anmelden",loginInvalid:"Ung\u00fcltige JID",reason:"Begr\u00fcndung:",subject:"Titel:",reasonWas:"Begr\u00fcndung: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"Du wurdest soeben aus dem Raum %1$s gekickt (%2$s)",youHaveBeenKicked:"Du wurdest soeben aus dem Raum %s gekickt",banActionLabel:"Ban",youHaveBeenBannedBy:"Du wurdest soeben aus dem Raum %1$s verbannt (%2$s)",youHaveBeenBanned:"Du wurdest soeben aus dem Raum %s verbannt",privateActionLabel:"Privater Chat",ignoreActionLabel:"Ignorieren",unignoreActionLabel:"Nicht mehr ignorieren",setSubjectActionLabel:"Thema \u00e4ndern",administratorMessageSubject:"Administrator",userJoinedRoom:"%s hat soeben den Raum betreten.",userLeftRoom:"%s hat soeben den Raum verlassen.",userHasBeenKickedFromRoom:"%s ist aus dem Raum gekickt worden.",userHasBeenBannedFromRoom:"%s ist aus dem Raum verbannt worden.",presenceUnknownWarningSubject:"Hinweis:",presenceUnknownWarning:"Dieser Benutzer k\u00f6nnte bereits abgemeldet sein. Wir k\u00f6nnen seine Anwesenheit nicht verfolgen.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"Du ignorierst diesen Benutzer",tooltipEmoticons:"Smileys",tooltipSound:"Ton abspielen bei neuen privaten Nachrichten",tooltipAutoscroll:"Autoscroll",tooltipStatusmessage:"Statusnachrichten anzeigen",tooltipAdministration:"Raum Administration",tooltipUsercount:"Anzahl Benutzer im Raum",enterRoomPassword:'Raum "%s" ist durch ein Passwort gesch\u00fctzt.',enterRoomPasswordSubmit:"Raum betreten",passwordEnteredInvalid:'Inkorrektes Passwort f\u00fcr Raum "%s".',nicknameConflict:"Der Benutzername wird bereits verwendet. Bitte w\u00e4hle einen anderen.",errorMembersOnly:'Du kannst den Raum "%s" nicht betreten: Ungen\u00fcgende Rechte.',errorMaxOccupantsReached:'Du kannst den Raum "%s" nicht betreten: Benutzerlimit erreicht.',antiSpamMessage:"Bitte nicht spammen. Du wurdest f\u00fcr eine kurze Zeit blockiert."},fr:{status:"Status: %s",statusConnecting:"Connecter...",statusConnected:"Connect\u00e9.",statusDisconnecting:"D\u00e9connecter....",statusDisconnected:"D\u00e9connect\u00e9.",statusAuthfail:"Authentification a \u00e9chou\u00e9",roomSubject:"Sujet:",messageSubmit:"Envoyer",labelUsername:"Nom d'utilisateur:",labelPassword:"Mot de passe:",loginSubmit:"Inscription",loginInvalid:"JID invalide",reason:"Justification:",subject:"Titre:",reasonWas:"Justification: %s.",kickActionLabel:"Kick",youHaveBeenKickedBy:"Tu as \u00e9t\u00e9 expuls\u00e9 de le salon %1$s (%2$s)",youHaveBeenKicked:"Tu as \u00e9t\u00e9 expuls\u00e9 de le salon %s",banActionLabel:"Ban",youHaveBeenBannedBy:"Tu as \u00e9t\u00e9 banni de le salon %1$s (%2$s)",youHaveBeenBanned:"Tu as \u00e9t\u00e9 banni de le salon %s",privateActionLabel:"Chat priv\u00e9",ignoreActionLabel:"Ignorer",unignoreActionLabel:"Ne plus ignorer",setSubjectActionLabel:"Changer le sujet",administratorMessageSubject:"Administrateur",userJoinedRoom:"%s vient d'entrer dans le salon.",userLeftRoom:"%s vient de quitter le salon.",userHasBeenKickedFromRoom:"%s a \u00e9t\u00e9 expuls\u00e9 du salon.",userHasBeenBannedFromRoom:"%s a \u00e9t\u00e9 banni du salon.",presenceUnknownWarningSubject:"Note:",presenceUnknownWarning:"Cet utilisateur n'est malheureusement plus connect\u00e9, le message ne sera pas envoy\u00e9.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Mod\u00e9rateur",tooltipIgnored:"Tu ignores cette personne",tooltipEmoticons:"Smileys",tooltipSound:"Jouer un son lorsque tu re\u00e7ois de nouveaux messages priv\u00e9s",tooltipAutoscroll:"Auto-defilement",tooltipStatusmessage:"Messages d'\u00e9tat",tooltipAdministration:"Administrer le salon",tooltipUsercount:"Nombre d'utilisateurs dans le salon",enterRoomPassword:'Le salon "%s" est prot\u00e9g\u00e9 par un mot de passe.',enterRoomPasswordSubmit:"Entrer dans le salon",passwordEnteredInvalid:'Le mot de passe four le salon "%s" est invalide.',nicknameConflict:"Le nom d'utilisateur est d\u00e9j\u00e0 utilis\u00e9. Choisi un autre.",errorMembersOnly:'Tu ne peut pas entrer de le salon "%s": droits insuffisants.',errorMaxOccupantsReached:'Tu ne peut pas entrer de le salon "%s": Limite d\'utilisateur atteint.',antiSpamMessage:"S'il te pla\u00eet, pas de spam. Tu as \u00e9t\u00e9 bloqu\u00e9 pendant une courte p\u00e9riode.."},nl:{status:"Status: %s",statusConnecting:"Verbinding maken...",statusConnected:"Verbinding is gereed",statusDisconnecting:"Verbinding verbreken...",statusDisconnected:"Verbinding is verbroken",statusAuthfail:"Authenticatie is mislukt",roomSubject:"Onderwerp:",messageSubmit:"Verstuur",labelUsername:"Gebruikersnaam:",labelPassword:"Wachtwoord:",loginSubmit:"Inloggen",loginInvalid:"JID is onjuist",reason:"Reden:",subject:"Onderwerp:",reasonWas:"De reden was: %s.",kickActionLabel:"Verwijderen",youHaveBeenKickedBy:"Je bent verwijderd van %1$s door %2$s",youHaveBeenKicked:"Je bent verwijderd van %s",banActionLabel:"Blokkeren",youHaveBeenBannedBy:"Je bent geblokkeerd van %1$s door %2$s",youHaveBeenBanned:"Je bent geblokkeerd van %s",privateActionLabel:"Prive gesprek",ignoreActionLabel:"Negeren",unignoreActionLabel:"Niet negeren",setSubjectActionLabel:"Onderwerp wijzigen",administratorMessageSubject:"Beheerder",userJoinedRoom:"%s komt de chat binnen.",userLeftRoom:"%s heeft de chat verlaten.",userHasBeenKickedFromRoom:"%s is verwijderd.",userHasBeenBannedFromRoom:"%s is geblokkeerd.",presenceUnknownWarningSubject:"Mededeling:",presenceUnknownWarning:"Deze gebruiker is waarschijnlijk offline, we kunnen zijn/haar aanwezigheid niet vaststellen.",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderator",tooltipIgnored:"Je negeert deze gebruiker",tooltipEmoticons:"Emotie-iconen",tooltipSound:"Speel een geluid af bij nieuwe priv\u00e9 berichten.",tooltipAutoscroll:"Automatisch scrollen",tooltipStatusmessage:"Statusberichten weergeven",tooltipAdministration:"Instellingen",tooltipUsercount:"Gebruikers",enterRoomPassword:'De Chatroom "%s" is met een wachtwoord beveiligd.',enterRoomPasswordSubmit:"Ga naar Chatroom",passwordEnteredInvalid:'Het wachtwoord voor de Chatroom "%s" is onjuist.',nicknameConflict:"De gebruikersnaam is reeds in gebruik. Probeer a.u.b. een andere gebruikersnaam.",errorMembersOnly:'Je kunt niet deelnemen aan de Chatroom "%s": Je hebt onvoldoende rechten.',errorMaxOccupantsReached:'Je kunt niet deelnemen aan de Chatroom "%s": Het maximum aantal gebruikers is bereikt.',antiSpamMessage:"Het is niet toegestaan om veel berichten naar de server te versturen. Je bent voor een korte periode geblokkeerd."},es:{status:"Estado: %s",statusConnecting:"Conectando...",statusConnected:"Conectado",statusDisconnecting:"Desconectando...",statusDisconnected:"Desconectado",statusAuthfail:"Fall\u00f3 la autenticaci\u00f3n",roomSubject:"Asunto:",messageSubmit:"Enviar",labelUsername:"Usuario:",labelPassword:"Clave:",loginSubmit:"Entrar",loginInvalid:"JID no v\u00e1lido",reason:"Raz\u00f3n:",subject:"Asunto:",reasonWas:"La raz\u00f3n fue: %s.",kickActionLabel:"Expulsar",youHaveBeenKickedBy:"Has sido expulsado de %1$s por %2$s",youHaveBeenKicked:"Has sido expulsado de %s",banActionLabel:"Prohibir",youHaveBeenBannedBy:"Has sido expulsado permanentemente de %1$s por %2$s",youHaveBeenBanned:"Has sido expulsado permanentemente de %s",privateActionLabel:"Chat privado",ignoreActionLabel:"Ignorar",unignoreActionLabel:"No ignorar",setSubjectActionLabel:"Cambiar asunto",administratorMessageSubject:"Administrador",userJoinedRoom:"%s se ha unido a la sala.",userLeftRoom:"%s ha dejado la sala.",userHasBeenKickedFromRoom:"%s ha sido expulsado de la sala.",userHasBeenBannedFromRoom:"%s ha sido expulsado permanentemente de la sala.",presenceUnknownWarningSubject:"Atenci\u00f3n:",presenceUnknownWarning:"\u00c9ste usuario podr\u00eda estar desconectado..",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"Moderador",tooltipIgnored:"Ignoras a \u00e9ste usuario",tooltipEmoticons:"Emoticonos",tooltipSound:"Reproducir un sonido para nuevos mensajes privados",tooltipAutoscroll:"Desplazamiento autom\u00e1tico",tooltipStatusmessage:"Mostrar mensajes de estado",tooltipAdministration:"Administraci\u00f3n de la sala",tooltipUsercount:"Usuarios en la sala",enterRoomPassword:'La sala "%s" est\u00e1 protegida mediante contrase\u00f1a.',enterRoomPasswordSubmit:"Unirse a la sala",passwordEnteredInvalid:'Contrase\u00f1a incorrecta para la sala "%s".',nicknameConflict:"El nombre de usuario ya est\u00e1 siendo utilizado. Por favor elija otro.",errorMembersOnly:'No se puede unir a la sala "%s": no tiene privilegios suficientes.',errorMaxOccupantsReached:'No se puede unir a la sala "%s": demasiados participantes.',antiSpamMessage:"Por favor, no hagas spam. Has sido bloqueado temporalmente."},cn:{status:"\u72b6\u6001: %s",statusConnecting:"\u8fde\u63a5\u4e2d...",statusConnected:"\u5df2\u8fde\u63a5",statusDisconnecting:"\u65ad\u5f00\u8fde\u63a5\u4e2d...",statusDisconnected:"\u5df2\u65ad\u5f00\u8fde\u63a5",statusAuthfail:"\u8ba4\u8bc1\u5931\u8d25",roomSubject:"\u4e3b\u9898:",messageSubmit:"\u53d1\u9001",labelUsername:"\u7528\u6237\u540d:",labelPassword:"\u5bc6\u7801:",loginSubmit:"\u767b\u5f55",loginInvalid:"\u7528\u6237\u540d\u4e0d\u5408\u6cd5",reason:"\u539f\u56e0:",subject:"\u4e3b\u9898:",reasonWas:"\u539f\u56e0\u662f: %s.",kickActionLabel:"\u8e22\u9664",youHaveBeenKickedBy:"\u4f60\u5728 %1$s \u88ab\u7ba1\u7406\u8005 %2$s \u8bf7\u51fa\u623f\u95f4",banActionLabel:"\u7981\u8a00",youHaveBeenBannedBy:"\u4f60\u5728 %1$s \u88ab\u7ba1\u7406\u8005 %2$s \u7981\u8a00",privateActionLabel:"\u5355\u72ec\u5bf9\u8bdd",ignoreActionLabel:"\u5ffd\u7565",unignoreActionLabel:"\u4e0d\u5ffd\u7565",setSubjectActionLabel:"\u53d8\u66f4\u4e3b\u9898",administratorMessageSubject:"\u7ba1\u7406\u5458",userJoinedRoom:"%s \u52a0\u5165\u623f\u95f4",userLeftRoom:"%s \u79bb\u5f00\u623f\u95f4",userHasBeenKickedFromRoom:"%s \u88ab\u8bf7\u51fa\u8fd9\u4e2a\u623f\u95f4",userHasBeenBannedFromRoom:"%s \u88ab\u7ba1\u7406\u8005\u7981\u8a00",presenceUnknownWarningSubject:"\u6ce8\u610f:",presenceUnknownWarning:"\u8fd9\u4e2a\u4f1a\u5458\u53ef\u80fd\u5df2\u7ecf\u4e0b\u7ebf\uff0c\u4e0d\u80fd\u8ffd\u8e2a\u5230\u4ed6\u7684\u8fde\u63a5\u4fe1\u606f",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"\u7ba1\u7406",tooltipIgnored:"\u4f60\u5ffd\u7565\u4e86\u8fd9\u4e2a\u4f1a\u5458",tooltipEmoticons:"\u8868\u60c5",tooltipSound:"\u65b0\u6d88\u606f\u53d1\u97f3",tooltipAutoscroll:"\u6eda\u52a8\u6761",tooltipStatusmessage:"\u7981\u7528\u72b6\u6001\u6d88\u606f",tooltipAdministration:"\u623f\u95f4\u7ba1\u7406",tooltipUsercount:"\u623f\u95f4\u5360\u6709\u8005",enterRoomPassword:'\u767b\u5f55\u623f\u95f4 "%s" \u9700\u8981\u5bc6\u7801.',enterRoomPasswordSubmit:"\u52a0\u5165\u623f\u95f4",passwordEnteredInvalid:'\u767b\u5f55\u623f\u95f4 "%s" \u7684\u5bc6\u7801\u4e0d\u6b63\u786e',nicknameConflict:"\u7528\u6237\u540d\u5df2\u7ecf\u5b58\u5728\uff0c\u8bf7\u53e6\u9009\u4e00\u4e2a",errorMembersOnly:'\u60a8\u7684\u6743\u9650\u4e0d\u591f\uff0c\u4e0d\u80fd\u767b\u5f55\u623f\u95f4 "%s" ',errorMaxOccupantsReached:'\u623f\u95f4 "%s" \u7684\u4eba\u6570\u5df2\u8fbe\u4e0a\u9650\uff0c\u60a8\u4e0d\u80fd\u767b\u5f55',antiSpamMessage:"\u56e0\u4e3a\u60a8\u5728\u77ed\u65f6\u95f4\u5185\u53d1\u9001\u8fc7\u591a\u7684\u6d88\u606f \u670d\u52a1\u5668\u8981\u963b\u6b62\u60a8\u4e00\u5c0f\u6bb5\u65f6\u95f4\u3002"},ja:{status:"\u30b9\u30c6\u30fc\u30bf\u30b9: %s",statusConnecting:"\u63a5\u7d9a\u4e2d\u2026",statusConnected:"\u63a5\u7d9a\u3055\u308c\u307e\u3057\u305f",statusDisconnecting:"\u30c7\u30a3\u30b9\u30b3\u30cd\u30af\u30c8\u4e2d\u2026",statusDisconnected:"\u30c7\u30a3\u30b9\u30b3\u30cd\u30af\u30c8\u3055\u308c\u307e\u3057\u305f",statusAuthfail:"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f",roomSubject:"\u30c8\u30d4\u30c3\u30af\uff1a",messageSubmit:"\u9001\u4fe1",labelUsername:"\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\uff1a",labelPassword:"\u30d1\u30b9\u30ef\u30fc\u30c9\uff1a",loginSubmit:"\u30ed\u30b0\u30a4\u30f3",loginInvalid:"\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093",reason:"\u7406\u7531\uff1a",subject:"\u30c8\u30d4\u30c3\u30af\uff1a",reasonWas:"\u7406\u7531: %s\u3002",kickActionLabel:"\u30ad\u30c3\u30af",youHaveBeenKickedBy:"\u3042\u306a\u305f\u306f%2$s\u306b\u3088\u308a%1$s\u304b\u3089\u30ad\u30c3\u30af\u3055\u308c\u307e\u3057\u305f\u3002",youHaveBeenKicked:"\u3042\u306a\u305f\u306f%s\u304b\u3089\u30ad\u30c3\u30af\u3055\u308c\u307e\u3057\u305f\u3002",banActionLabel:"\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30f3",youHaveBeenBannedBy:"\u3042\u306a\u305f\u306f%2$s\u306b\u3088\u308a%1$s\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30f3\u3055\u308c\u307e\u3057\u305f\u3002",youHaveBeenBanned:"\u3042\u306a\u305f\u306f%s\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30f3\u3055\u308c\u307e\u3057\u305f\u3002",privateActionLabel:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8",ignoreActionLabel:"\u7121\u8996\u3059\u308b",unignoreActionLabel:"\u7121\u8996\u3092\u3084\u3081\u308b",setSubjectActionLabel:"\u30c8\u30d4\u30c3\u30af\u3092\u5909\u3048\u308b",administratorMessageSubject:"\u7ba1\u7406\u8005",userJoinedRoom:"%s\u306f\u5165\u5ba4\u3057\u307e\u3057\u305f\u3002",userLeftRoom:"%s\u306f\u9000\u5ba4\u3057\u307e\u3057\u305f\u3002",userHasBeenKickedFromRoom:"%s\u306f\u90e8\u5c4b\u304b\u3089\u30ad\u30c3\u30af\u3055\u308c\u307e\u3057\u305f\u3002",userHasBeenBannedFromRoom:"%s\u306f\u90e8\u5c4b\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30f3\u3055\u308c\u307e\u3057\u305f\u3002",presenceUnknownWarningSubject:"\u5fe0\u544a\uff1a",presenceUnknownWarning:"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306f\u4e0d\u660e\u3067\u3059\u3002",dateFormat:"dd.mm.yyyy",timeFormat:"HH:MM:ss",tooltipRole:"\u30e2\u30c7\u30ec\u30fc\u30bf\u30fc",tooltipIgnored:"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u7121\u8996\u8a2d\u5b9a\u306b\u3057\u3066\u3044\u308b",tooltipEmoticons:"\u7d75\u6587\u5b57",tooltipSound:"\u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304f\u305f\u3073\u306b\u97f3\u3092\u9cf4\u3089\u3059",tooltipAutoscroll:"\u30aa\u30fc\u30c8\u30b9\u30af\u30ed\u30fc\u30eb",tooltipStatusmessage:"\u30b9\u30c6\u30fc\u30bf\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a",tooltipAdministration:"\u90e8\u5c4b\u306e\u7ba1\u7406",tooltipUsercount:"\u3053\u306e\u90e8\u5c4b\u306e\u53c2\u52a0\u8005\u306e\u6570",enterRoomPassword:'"%s"\u306e\u90e8\u5c4b\u306b\u5165\u308b\u306b\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u5fc5\u8981\u3067\u3059\u3002',enterRoomPasswordSubmit:"\u90e8\u5c4b\u306b\u5165\u308b",passwordEnteredInvalid:'"%s"\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u7570\u306a\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3057\u305f\u3002',nicknameConflict:"\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u3059\u3067\u306b\u5229\u7528\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u5225\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u9078\u3093\u3067\u304f\u3060\u3055\u3044\u3002",errorMembersOnly:'"%s"\u306e\u90e8\u5c4b\u306b\u5165\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093: \u5229\u7528\u6a29\u9650\u3092\u6e80\u305f\u3057\u3066\u3044\u307e\u305b\u3093\u3002',errorMaxOccupantsReached:'"%s"\u306e\u90e8\u5c4b\u306b\u5165\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093: \u53c2\u52a0\u8005\u306e\u6570\u306f\u3059\u3067\u306b\u4e0a\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002',antiSpamMessage:"\u30b9\u30d1\u30e0\u306a\u3069\u306e\u884c\u70ba\u306f\u3084\u3081\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u306a\u305f\u306f\u4e00\u6642\u7684\u306b\u30d6\u30ed\u30c3\u30af\u3055\u308c\u307e\u3057\u305f\u3002"}}